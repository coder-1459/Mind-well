<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Tracker - MindWell</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-brain"></i>
                <span>MindWell</span>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="assessment.html">Assessment</a></li>
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="tasks.html">Daily Tasks</a></li>
                <li><a href="mood.html" class="active">Mood Tracker</a></li>
                <li><a href="appointments.html">Book Appointment</a></li>
            </ul>
            <div class="theme-toggle">
                <button id="theme-toggle-btn" class="theme-toggle-btn" title="Toggle Dark Mode">
                    <i class="fas fa-moon" id="theme-icon"></i>
                </button>
            </div>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <section class="mood-section">
        <div class="container">
            <!-- Header -->
            <div class="mood-header">
                <h1 class="section-title">Daily Mood Tracker</h1>
                <p class="section-description">
                    Track your emotional well-being daily to identify patterns and improve your mental health journey. 
                    Understanding your mood patterns helps you make better decisions for your wellness.
                </p>
            </div>

            <!-- Today's Mood Logger -->
            <div class="today-mood-section">
                <div class="mood-card">
                    <div class="mood-card-header">
                        <h2><i class="fas fa-calendar-day"></i> How are you feeling today?</h2>
                        <div class="current-date" id="currentDate">Today</div>
                    </div>
                    
                    <div class="mood-selector" id="moodSelector">
                        <div class="mood-option" data-mood="excellent" data-emoji="üòÑ" data-value="5">
                            <div class="mood-emoji">üòÑ</div>
                            <div class="mood-label">Excellent</div>
                            <div class="mood-description">Feeling amazing and energetic</div>
                        </div>
                        <div class="mood-option" data-mood="good" data-emoji="üòä" data-value="4">
                            <div class="mood-emoji">üòä</div>
                            <div class="mood-label">Good</div>
                            <div class="mood-description">Happy and positive</div>
                        </div>
                        <div class="mood-option" data-mood="okay" data-emoji="üòê" data-value="3">
                            <div class="mood-emoji">üòê</div>
                            <div class="mood-label">Okay</div>
                            <div class="mood-description">Neutral, neither good nor bad</div>
                        </div>
                        <div class="mood-option" data-mood="low" data-emoji="üòî" data-value="2">
                            <div class="mood-emoji">üòî</div>
                            <div class="mood-label">Low</div>
                            <div class="mood-description">Feeling down or tired</div>
                        </div>
                        <div class="mood-option" data-mood="poor" data-emoji="üòû" data-value="1">
                            <div class="mood-emoji">üòû</div>
                            <div class="mood-label">Poor</div>
                            <div class="mood-description">Struggling emotionally</div>
                        </div>
                    </div>

                    <!-- Additional Details -->
                    <div class="mood-details" id="moodDetails" style="display: none;">
                        <div class="details-grid">
                            <div class="detail-item">
                                <label>Energy Level</label>
                                <div class="slider-container">
                                    <input type="range" id="energyLevel" min="1" max="10" value="5" class="mood-slider">
                                    <div class="slider-labels">
                                        <span>Low</span>
                                        <span id="energyValue">5</span>
                                        <span>High</span>
                                    </div>
                                </div>
                            </div>
                            <div class="detail-item">
                                <label>Stress Level</label>
                                <div class="slider-container">
                                    <input type="range" id="stressLevel" min="1" max="10" value="5" class="mood-slider">
                                    <div class="slider-labels">
                                        <span>Low</span>
                                        <span id="stressValue">5</span>
                                        <span>High</span>
                                    </div>
                                </div>
                            </div>
                            <div class="detail-item">
                                <label>Sleep Quality (last night)</label>
                                <div class="slider-container">
                                    <input type="range" id="sleepQuality" min="1" max="10" value="5" class="mood-slider">
                                    <div class="slider-labels">
                                        <span>Poor</span>
                                        <span id="sleepValue">5</span>
                                        <span>Excellent</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mood-factors">
                            <label>What's affecting your mood today? (optional)</label>
                            <div class="factors-grid">
                                <button class="factor-tag" data-factor="work">Work</button>
                                <button class="factor-tag" data-factor="relationships">Relationships</button>
                                <button class="factor-tag" data-factor="health">Health</button>
                                <button class="factor-tag" data-factor="weather">Weather</button>
                                <button class="factor-tag" data-factor="sleep">Sleep</button>
                                <button class="factor-tag" data-factor="exercise">Exercise</button>
                                <button class="factor-tag" data-factor="social">Social</button>
                                <button class="factor-tag" data-factor="finances">Finances</button>
                                <button class="factor-tag" data-factor="family">Family</button>
                                <button class="factor-tag" data-factor="other">Other</button>
                            </div>
                        </div>

                        <div class="mood-notes">
                            <label>Additional notes (optional)</label>
                            <textarea id="moodNotes" class="form-control" rows="3" placeholder="How are you feeling? What happened today? Any reflections..."></textarea>
                        </div>

                        <div class="mood-actions">
                            <button class="btn btn-secondary" id="cancelMood">Cancel</button>
                            <button class="btn btn-primary" id="saveMood">Save Mood Entry</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mood Statistics -->
            <div class="mood-stats-section">
                <h2 class="section-title">Your Mood Insights</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="averageMood">--</h3>
                            <p>Average Mood</p>
                            <small id="moodTrend">-- trend</small>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="trackingStreak">0</h3>
                            <p>Day Tracking Streak</p>
                            <small>Keep it up!</small>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-smile-beam"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="goodDaysCount">0</h3>
                            <p>Good Days This Month</p>
                            <small id="goodDaysPercent">0% of tracked days</small>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="topFactor">--</h3>
                            <p>Most Common Factor</p>
                            <small>Affecting your mood</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mood History -->
            <div class="mood-history-section">
                <div class="history-header">
                    <h2 class="section-title">Mood History</h2>
                    <div class="history-controls">
                        <select id="historyFilter" class="form-control">
                            <option value="7">Last 7 days</option>
                            <option value="30">Last 30 days</option>
                            <option value="90">Last 3 months</option>
                        </select>
                    </div>
                </div>

                <div class="mood-calendar" id="moodCalendar">
                    <!-- Calendar will be generated here -->
                </div>

                <div class="mood-chart-container">
                    <canvas id="moodChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Recent Entries -->
            <div class="recent-entries-section">
                <h2 class="section-title">Recent Mood Entries</h2>
                <div class="recent-entries-list" id="recentEntriesList">
                    <!-- Recent entries will be shown here -->
                </div>
            </div>

            <!-- Mood Tips -->
            <div class="mood-tips-section">
                <h2 class="section-title">Mood Improvement Tips</h2>
                <div class="tips-grid" id="moodTips">
                    <!-- Tips will be generated based on mood patterns -->
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>MindWell</h3>
                    <p>Your companion for mental wellness and cognitive growth</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="assessment.html">Take Assessment</a></li>
                        <li><a href="tasks.html">Daily Tasks</a></li>
                        <li><a href="appointments.html">Book Appointment</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="#">Mental Health Tips</a></li>
                        <li><a href="#">Emergency Helpline</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 MindWell. Created with care for mental wellness.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Initialize theme manager for this page
        document.addEventListener('DOMContentLoaded', () => {
            if (!window.themeManager) {
                window.themeManager = new ThemeManager();
            }
        });
        class MoodTracker {
            constructor() {
                this.selectedMood = null;
                this.selectedFactors = [];
                this.init();
            }

            init() {
                this.updateCurrentDate();
                this.bindEvents();
                this.loadTodaysMood();
                this.updateStats();
                this.loadMoodHistory();
                this.loadRecentEntries();
                this.generateMoodTips();
                this.drawMoodChart();
            }

            bindEvents() {
                // Mood selection
                document.querySelectorAll('.mood-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        this.selectMood(e.currentTarget);
                    });
                });

                // Sliders
                ['energyLevel', 'stressLevel', 'sleepQuality'].forEach(id => {
                    const slider = document.getElementById(id);
                    if (slider) {
                        slider.addEventListener('input', (e) => {
                            document.getElementById(id.replace('Level', 'Value').replace('Quality', 'Value'))
                                .textContent = e.target.value;
                        });
                    }
                });

                // Factor tags
                document.querySelectorAll('.factor-tag').forEach(tag => {
                    tag.addEventListener('click', (e) => {
                        this.toggleFactor(e.target);
                    });
                });

                // Mood actions
                document.getElementById('saveMood').addEventListener('click', () => {
                    this.saveMoodEntry();
                });

                document.getElementById('cancelMood').addEventListener('click', () => {
                    this.cancelMoodEntry();
                });

                // History filter
                document.getElementById('historyFilter').addEventListener('change', (e) => {
                    this.loadMoodHistory(parseInt(e.target.value));
                });
            }

            updateCurrentDate() {
                const today = new Date();
                document.getElementById('currentDate').textContent = 
                    today.toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
            }

            selectMood(option) {
                // Remove previous selection
                document.querySelectorAll('.mood-option').forEach(opt => {
                    opt.classList.remove('selected');
                });

                // Select new mood
                option.classList.add('selected');
                this.selectedMood = {
                    mood: option.dataset.mood,
                    emoji: option.dataset.emoji,
                    value: parseInt(option.dataset.value),
                    label: option.querySelector('.mood-label').textContent
                };

                // Show details section
                document.getElementById('moodDetails').style.display = 'block';
            }

            toggleFactor(tag) {
                const factor = tag.dataset.factor;
                
                if (tag.classList.contains('selected')) {
                    tag.classList.remove('selected');
                    this.selectedFactors = this.selectedFactors.filter(f => f !== factor);
                } else {
                    tag.classList.add('selected');
                    this.selectedFactors.push(factor);
                }
            }

            saveMoodEntry() {
                if (!this.selectedMood) {
                    Utils.showNotification('Please select your mood first', 'error');
                    return;
                }

                const moodEntry = {
                    mood: this.selectedMood.mood,
                    emoji: this.selectedMood.emoji,
                    value: this.selectedMood.value,
                    label: this.selectedMood.label,
                    energyLevel: parseInt(document.getElementById('energyLevel').value),
                    stressLevel: parseInt(document.getElementById('stressLevel').value),
                    sleepQuality: parseInt(document.getElementById('sleepQuality').value),
                    factors: [...this.selectedFactors],
                    notes: document.getElementById('moodNotes').value.trim()
                };

                storage.addMoodEntry(moodEntry);
                Utils.showNotification('Mood entry saved successfully!', 'success');
                
                this.resetMoodForm();
                this.updateStats();
                this.loadMoodHistory();
                this.loadRecentEntries();
                this.generateMoodTips();
                this.drawMoodChart();
            }

            cancelMoodEntry() {
                this.resetMoodForm();
            }

            resetMoodForm() {
                // Reset selections
                document.querySelectorAll('.mood-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                document.querySelectorAll('.factor-tag').forEach(tag => {
                    tag.classList.remove('selected');
                });

                // Reset form values
                document.getElementById('energyLevel').value = 5;
                document.getElementById('stressLevel').value = 5;
                document.getElementById('sleepQuality').value = 5;
                document.getElementById('energyValue').textContent = 5;
                document.getElementById('stressValue').textContent = 5;
                document.getElementById('sleepValue').textContent = 5;
                document.getElementById('moodNotes').value = '';

                // Hide details
                document.getElementById('moodDetails').style.display = 'none';

                // Reset state
                this.selectedMood = null;
                this.selectedFactors = [];
            }

            loadTodaysMood() {
                const data = storage.getData();
                const today = new Date().toDateString();
                const todaysMood = data.moodEntries.find(entry => 
                    new Date(entry.date).toDateString() === today
                );

                if (todaysMood) {
                    // Show that mood has been logged for today
                    const moodCard = document.querySelector('.mood-card');
                    moodCard.classList.add('completed');
                    
                    const header = moodCard.querySelector('.mood-card-header h2');
                    header.innerHTML = `<i class="fas fa-check-circle"></i> Today's mood logged: ${todaysMood.emoji} ${todaysMood.label}`;
                    
                    // Add option to update
                    const updateButton = document.createElement('button');
                    updateButton.className = 'btn btn-secondary btn-sm';
                    updateButton.innerHTML = '<i class="fas fa-edit"></i> Update';
                    updateButton.onclick = () => this.editTodaysMood(todaysMood);
                    
                    header.parentNode.appendChild(updateButton);
                }
            }

            editTodaysMood(moodEntry) {
                // Populate form with existing data
                const moodOption = document.querySelector(`[data-mood="${moodEntry.mood}"]`);
                if (moodOption) {
                    this.selectMood(moodOption);
                }

                document.getElementById('energyLevel').value = moodEntry.energyLevel || 5;
                document.getElementById('stressLevel').value = moodEntry.stressLevel || 5;
                document.getElementById('sleepQuality').value = moodEntry.sleepQuality || 5;
                document.getElementById('moodNotes').value = moodEntry.notes || '';

                // Update slider displays
                document.getElementById('energyValue').textContent = moodEntry.energyLevel || 5;
                document.getElementById('stressValue').textContent = moodEntry.stressLevel || 5;
                document.getElementById('sleepValue').textContent = moodEntry.sleepQuality || 5;

                // Select factors
                if (moodEntry.factors) {
                    moodEntry.factors.forEach(factor => {
                        const tag = document.querySelector(`[data-factor="${factor}"]`);
                        if (tag) {
                            tag.classList.add('selected');
                            this.selectedFactors.push(factor);
                        }
                    });
                }

                // Reset completed state
                document.querySelector('.mood-card').classList.remove('completed');
                document.querySelector('.mood-card-header h2').innerHTML = 
                    '<i class="fas fa-edit"></i> Update today\'s mood';
            }

            updateStats() {
                const data = storage.getData();
                const entries = data.moodEntries;

                if (entries.length === 0) {
                    return;
                }

                // Average mood
                const avgMood = entries.reduce((sum, entry) => sum + entry.value, 0) / entries.length;
                document.getElementById('averageMood').textContent = avgMood.toFixed(1);

                // Tracking streak
                const streak = this.calculateStreak(entries);
                document.getElementById('trackingStreak').textContent = streak;

                // Good days this month
                const thisMonth = new Date();
                const goodDays = entries.filter(entry => {
                    const entryDate = new Date(entry.date);
                    return entryDate.getMonth() === thisMonth.getMonth() && 
                           entryDate.getFullYear() === thisMonth.getFullYear() &&
                           entry.value >= 4;
                }).length;

                const totalDaysThisMonth = entries.filter(entry => {
                    const entryDate = new Date(entry.date);
                    return entryDate.getMonth() === thisMonth.getMonth() && 
                           entryDate.getFullYear() === thisMonth.getFullYear();
                }).length;

                document.getElementById('goodDaysCount').textContent = goodDays;
                document.getElementById('goodDaysPercent').textContent = 
                    totalDaysThisMonth > 0 ? `${Math.round((goodDays / totalDaysThisMonth) * 100)}% of tracked days` : '0% of tracked days';

                // Most common factor
                const factorCounts = {};
                entries.forEach(entry => {
                    if (entry.factors) {
                        entry.factors.forEach(factor => {
                            factorCounts[factor] = (factorCounts[factor] || 0) + 1;
                        });
                    }
                });

                const topFactor = Object.keys(factorCounts).reduce((a, b) => 
                    factorCounts[a] > factorCounts[b] ? a : b, '--');
                
                document.getElementById('topFactor').textContent = 
                    topFactor !== '--' ? topFactor.charAt(0).toUpperCase() + topFactor.slice(1) : '--';

                // Mood trend
                this.calculateMoodTrend(entries);
            }

            calculateStreak(entries) {
                if (entries.length === 0) return 0;

                const sortedEntries = entries.sort((a, b) => new Date(b.date) - new Date(a.date));
                let streak = 0;
                const today = new Date();
                
                for (let i = 0; i < sortedEntries.length; i++) {
                    const entryDate = new Date(sortedEntries[i].date);
                    const daysDiff = Math.floor((today - entryDate) / (1000 * 60 * 60 * 24));
                    
                    if (daysDiff === streak) {
                        streak++;
                    } else {
                        break;
                    }
                }
                
                return streak;
            }

            calculateMoodTrend(entries) {
                if (entries.length < 2) {
                    document.getElementById('moodTrend').textContent = 'Not enough data';
                    return;
                }

                const recent = entries.slice(-7); // Last 7 entries
                const older = entries.slice(-14, -7); // 7 entries before that

                if (older.length === 0) {
                    document.getElementById('moodTrend').textContent = 'Not enough data';
                    return;
                }

                const recentAvg = recent.reduce((sum, e) => sum + e.value, 0) / recent.length;
                const olderAvg = older.reduce((sum, e) => sum + e.value, 0) / older.length;

                const trend = recentAvg - olderAvg;
                const trendElement = document.getElementById('moodTrend');

                if (trend > 0.2) {
                    trendElement.textContent = '‚ÜóÔ∏è Improving';
                    trendElement.style.color = 'var(--secondary-color)';
                } else if (trend < -0.2) {
                    trendElement.textContent = '‚ÜòÔ∏è Declining';
                    trendElement.style.color = 'var(--danger-color)';
                } else {
                    trendElement.textContent = '‚Üí Stable';
                    trendElement.style.color = 'var(--text-secondary)';
                }
            }

            loadMoodHistory(days = 30) {
                const data = storage.getData();
                const entries = data.moodEntries;
                
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                
                const filteredEntries = entries.filter(entry => 
                    new Date(entry.date) >= cutoffDate
                );

                this.renderMoodCalendar(filteredEntries, days);
            }

            renderMoodCalendar(entries, days) {
                const container = document.getElementById('moodCalendar');
                const today = new Date();
                
                let calendarHTML = '<div class="calendar-grid">';
                
                for (let i = days - 1; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(today.getDate() - i);
                    
                    const entry = entries.find(e => 
                        new Date(e.date).toDateString() === date.toDateString()
                    );
                    
                    const isToday = date.toDateString() === today.toDateString();
                    
                    calendarHTML += `
                        <div class="calendar-day ${isToday ? 'today' : ''} ${entry ? 'has-entry' : ''}" 
                             title="${date.toLocaleDateString()}${entry ? `: ${entry.label}` : ': No entry'}">
                            <div class="day-number">${date.getDate()}</div>
                            ${entry ? `<div class="day-mood">${entry.emoji}</div>` : '<div class="day-empty">¬∑</div>'}
                        </div>
                    `;
                }
                
                calendarHTML += '</div>';
                container.innerHTML = calendarHTML;
            }

            loadRecentEntries() {
                const data = storage.getData();
                const entries = data.moodEntries
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 10);

                const container = document.getElementById('recentEntriesList');
                
                if (entries.length === 0) {
                    container.innerHTML = `
                        <div class="no-entries">
                            <i class="fas fa-smile"></i>
                            <p>No mood entries yet. Start tracking your mood above!</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = entries.map(entry => `
                    <div class="mood-entry-card">
                        <div class="entry-date">
                            <div class="entry-emoji">${entry.emoji}</div>
                            <div class="entry-info">
                                <h4>${entry.label}</h4>
                                <p>${Utils.formatDate(entry.date)}</p>
                            </div>
                        </div>
                        <div class="entry-details">
                            ${entry.factors && entry.factors.length > 0 ? 
                                `<div class="entry-factors">
                                    ${entry.factors.map(f => `<span class="factor-badge">${f}</span>`).join('')}
                                </div>` : ''}
                            ${entry.notes ? `<p class="entry-notes">${entry.notes}</p>` : ''}
                            <div class="entry-metrics">
                                <span><i class="fas fa-bolt"></i> Energy: ${entry.energyLevel || 'N/A'}</span>
                                <span><i class="fas fa-weight-hanging"></i> Stress: ${entry.stressLevel || 'N/A'}</span>
                                <span><i class="fas fa-bed"></i> Sleep: ${entry.sleepQuality || 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            generateMoodTips() {
                const data = storage.getData();
                const entries = data.moodEntries;
                
                let tips = [];

                if (entries.length === 0) {
                    tips = [
                        {
                            icon: 'fas fa-lightbulb',
                            title: 'Start Tracking',
                            description: 'Begin by logging your mood daily to identify patterns and triggers.'
                        },
                        {
                            icon: 'fas fa-heart',
                            title: 'Be Consistent',
                            description: 'Track your mood at the same time each day for better insights.'
                        }
                    ];
                } else {
                    const avgMood = entries.reduce((sum, e) => sum + e.value, 0) / entries.length;
                    const recentEntries = entries.slice(-7);
                    const avgEnergy = recentEntries.reduce((sum, e) => sum + (e.energyLevel || 0), 0) / recentEntries.length;
                    const avgStress = recentEntries.reduce((sum, e) => sum + (e.stressLevel || 0), 0) / recentEntries.length;

                    if (avgMood < 3) {
                        tips.push({
                            icon: 'fas fa-phone',
                            title: 'Consider Professional Support',
                            description: 'Your recent mood patterns suggest you might benefit from talking to a mental health professional.'
                        });
                    }

                    if (avgStress > 7) {
                        tips.push({
                            icon: 'fas fa-leaf',
                            title: 'Manage Stress',
                            description: 'Try relaxation techniques like deep breathing, meditation, or gentle exercise.'
                        });
                    }

                    if (avgEnergy < 4) {
                        tips.push({
                            icon: 'fas fa-running',
                            title: 'Boost Energy',
                            description: 'Regular exercise, good sleep, and proper nutrition can help improve energy levels.'
                        });
                    }

                    // Default positive tips
                    tips.push({
                        icon: 'fas fa-sun',
                        title: 'Celebrate Progress',
                        description: 'Acknowledge your commitment to tracking your mental health - every small step counts!'
                    });
                }

                const container = document.getElementById('moodTips');
                container.innerHTML = tips.map(tip => `
                    <div class="tip-card">
                        <div class="tip-icon">
                            <i class="${tip.icon}"></i>
                        </div>
                        <div class="tip-content">
                            <h4>${tip.title}</h4>
                            <p>${tip.description}</p>
                        </div>
                    </div>
                `).join('');
            }

            drawMoodChart() {
                const canvas = document.getElementById('moodChart');
                const ctx = canvas.getContext('2d');
                const data = storage.getData();
                const entries = data.moodEntries
                    .filter(entry => {
                        const entryDate = new Date(entry.date);
                        const thirtyDaysAgo = new Date();
                        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                        return entryDate >= thirtyDaysAgo;
                    })
                    .sort((a, b) => new Date(a.date) - new Date(b.date));

                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                if (entries.length === 0) {
                    ctx.fillStyle = '#6b7280';
                    ctx.font = '16px Inter';
                    ctx.textAlign = 'center';
                    ctx.fillText('No mood data to display', canvas.width / 2, canvas.height / 2);
                    return;
                }

                // Chart dimensions
                const padding = 40;
                const chartWidth = canvas.width - 2 * padding;
                const chartHeight = canvas.height - 2 * padding;

                // Draw grid lines
                ctx.strokeStyle = '#e5e7eb';
                ctx.lineWidth = 1;
                
                for (let i = 1; i <= 5; i++) {
                    const y = padding + (chartHeight / 5) * (5 - i);
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(canvas.width - padding, y);
                    ctx.stroke();
                }

                // Draw mood line
                ctx.strokeStyle = '#6366f1';
                ctx.lineWidth = 3;
                ctx.beginPath();

                entries.forEach((entry, index) => {
                    const x = padding + (chartWidth / (entries.length - 1)) * index;
                    const y = padding + chartHeight - (chartHeight / 5) * (entry.value - 1);
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                
                ctx.stroke();

                // Draw data points
                ctx.fillStyle = '#6366f1';
                entries.forEach((entry, index) => {
                    const x = padding + (chartWidth / (entries.length - 1)) * index;
                    const y = padding + chartHeight - (chartHeight / 5) * (entry.value - 1);
                    
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, 2 * Math.PI);
                    ctx.fill();
                });

                // Y-axis labels
                ctx.fillStyle = '#6b7280';
                ctx.font = '12px Inter';
                ctx.textAlign = 'right';
                
                const moodLabels = ['Poor', 'Low', 'Okay', 'Good', 'Excellent'];
                for (let i = 0; i < 5; i++) {
                    const y = padding + (chartHeight / 5) * (4 - i) + 4;
                    ctx.fillText(moodLabels[i], padding - 10, y);
                }
            }
        }

        // Initialize mood tracker
        document.addEventListener('DOMContentLoaded', () => {
            if (window.location.pathname.includes('mood.html')) {
                new MoodTracker();
            }
        });
    </script>

    <style>
        /* Mood tracker specific styles */
        .mood-section {
            padding: 2rem 0 4rem;
            min-height: 80vh;
        }

        .mood-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .today-mood-section {
            margin-bottom: 4rem;
        }

        .mood-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 2rem;
            transition: var(--transition);
        }

        .mood-card.completed {
            border-left: 4px solid var(--secondary-color);
            background: rgba(16, 185, 129, 0.05);
        }

        .mood-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .mood-card-header h2 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0;
            color: var(--text-primary);
        }

        .current-date {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .mood-selector {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 2rem 0;
        }

        .mood-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 1.5rem 1rem;
            border-radius: var(--radius-lg);
            transition: var(--transition);
            border: 2px solid transparent;
            background: var(--bg-secondary);
            min-width: 120px;
        }

        .mood-option:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .mood-option.selected {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.1);
        }

        .mood-emoji {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .mood-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .mood-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-align: center;
        }

        .mood-details {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .detail-item label {
            display: block;
            margin-bottom: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .slider-container {
            position: relative;
        }

        .mood-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--bg-secondary);
            outline: none;
            -webkit-appearance: none;
        }

        .mood-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }

        .mood-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: none;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .slider-labels span:nth-child(2) {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1rem;
        }

        .mood-factors {
            margin-bottom: 2rem;
        }

        .mood-factors label {
            display: block;
            margin-bottom: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .factors-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .factor-tag {
            padding: 0.5rem 1rem;
            border: 2px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
        }

        .factor-tag:hover {
            border-color: var(--primary-color);
        }

        .factor-tag.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .mood-notes {
            margin-bottom: 2rem;
        }

        .mood-notes label {
            display: block;
            margin-bottom: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .mood-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .stat-card {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            background: var(--bg-card);
            padding: 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .stat-icon i {
            font-size: 1.5rem;
            color: white;
        }

        .stat-content h3 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .stat-content p {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .stat-content small {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .mood-history-section {
            margin-bottom: 4rem;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .history-controls select {
            min-width: 150px;
        }

        .mood-calendar {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            margin-bottom: 2rem;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 0.5rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
            background: var(--bg-secondary);
            position: relative;
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar-day:hover {
            transform: scale(1.1);
        }

        .calendar-day.today {
            border: 2px solid var(--primary-color);
        }

        .calendar-day.has-entry {
            background: rgba(99, 102, 241, 0.1);
        }

        .day-number {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .day-mood {
            font-size: 1.2rem;
        }

        .day-empty {
            color: var(--text-secondary);
            opacity: 0.3;
        }

        .mood-chart-container {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }

        .recent-entries-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .mood-entry-card {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }

        .entry-date {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-shrink: 0;
        }

        .entry-emoji {
            font-size: 2rem;
        }

        .entry-info h4 {
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .entry-info p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .entry-details {
            flex: 1;
        }

        .entry-factors {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            margin-bottom: 0.5rem;
        }

        .factor-badge {
            padding: 0.25rem 0.5rem;
            background: var(--bg-secondary);
            border-radius: 12px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .entry-notes {
            font-style: italic;
            color: var(--text-secondary);
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }

        .entry-metrics {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .entry-metrics span {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .tip-card {
            display: flex;
            gap: 1rem;
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }

        .tip-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-color), #f59e0b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .tip-icon i {
            color: white;
            font-size: 1.25rem;
        }

        .tip-content h4 {
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .tip-content p {
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .no-entries {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .no-entries i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .mood-selector {
                grid-template-columns: repeat(2, 1fr);
            }

            .mood-option {
                min-width: auto;
            }

            .details-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .history-header {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
            }

            .mood-entry-card {
                flex-direction: column;
                align-items: stretch;
            }

            .entry-metrics {
                flex-direction: column;
                gap: 0.5rem;
            }

            .mood-actions {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .mood-selector {
                grid-template-columns: 1fr;
            }

            .factors-grid {
                justify-content: center;
            }

            .tips-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
